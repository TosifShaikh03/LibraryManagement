<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Librarian Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen transition-colors duration-300">
  <!-- Navbar -->
  <nav class="bg-gray-800 p-4 shadow-md fixed w-full top-0 z-10 transition-colors duration-300">
    <div class="container mx-auto flex justify-between items-center">
      <!-- College Logo -->
      <div class="flex items-center">
        <img src="logo-meta-tag.png" alt="College Logo" class="h-15 w-20 mr-2">
        <!-- <span class="text-xl font-bold">College Library</span> -->
      </div>
      <!-- Hamburger Menu -->
      <div class="relative">
        <button onclick="toggleMenu()" class="text-white focus:outline-none flex flex-col justify-between w-8 h-6">
          <span class="bg-white h-1 w-full rounded"></span>
          <span class="bg-white h-1 w-full rounded"></span>
          <span class="bg-white h-1 w-full rounded"></span>
        </button>
        <div id="menu" class="hidden absolute right-0 mt-2 w-48 bg-gray-700 rounded-md shadow-lg transition-colors duration-300">
          <a href="#" onclick="showSection('dashboard')" class="block px-4 py-2 hover:bg-gray-600">Dashboard</a>
          <a href="#" onclick="showSection('total-books')" class="block px-4 py-2 hover:bg-gray-600">Total Books</a>
          <a href="#" onclick="showSection('available-books')" class="block px-4 py-2 hover:bg-gray-600">Available Books</a>
          <a href="#" onclick="showSection('student-details')" class="block px-4 py-2 hover:bg-gray-600">Student Details</a>
          <a href="#" onclick="showSection('settings')" class="block px-4 py-2 hover:bg-gray-600">Settings</a>
          <a href="index.html" class="block px-4 py-2 hover:bg-gray-600">Back to Home</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mx-auto mt-20 p-4">
    <!-- Dashboard Section -->
    <div id="dashboard" class="section">
      <h2 class="text-2xl font-bold mb-4">Librarian Dashboard</h2>
      <p class="text-gray-300 mb-4 transition-colors duration-300">Manage books and student borrowing records.</p>
      <!-- Add Book Form -->
      <div class="bg-gray-700 p-4 rounded-lg mb-4 transition-colors duration-300">
        <h3 class="text-lg font-semibold mb-2">Add New Book</h3>
        <input id="add-title" type="text" placeholder="Title" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <input id="add-author" type="text" placeholder="Author" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <input id="add-quantity" type="number" placeholder="Quantity" min="1" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <button onclick="addBook()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Add Book</button>
      </div>
      <!-- Remove Book Form -->
      <div class="bg-gray-700 p-4 rounded-lg mb-4 transition-colors duration-300">
        <h3 class="text-lg font-semibold mb-2">Remove Book</h3>
        <input id="remove-id" type="text" placeholder="Book ID or Title" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <button onclick="removeBook()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Remove Book</button>
      </div>
      <!-- Mark Book as Returned -->
      <div class="bg-gray-700 p-4 rounded-lg mb-4 transition-colors duration-300">
        <h3 class="text-lg font-semibold mb-2">Mark Book as Returned</h3>
        <input id="return-student-id" type="text" placeholder="Student ID" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <button onclick="markBookReturned()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Mark Returned</button>
      </div>
      <!-- Add Student Borrowing Form -->
      <div class="bg-gray-700 p-4 rounded-lg transition-colors duration-300">
        <h3 class="text-lg font-semibold mb-2">Add Student Borrowing</h3>
        <input id="borrow-student-id" type="text" placeholder="Student ID (e.g., S003)" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <input id="borrow-name" type="text" placeholder="Student Name" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <input id="borrow-phone" type="text" placeholder="Phone Number" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <input id="borrow-class" type="text" placeholder="Class (e.g., BSc CS)" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <input id="borrow-book-id" type="text" placeholder="Book ID (e.g., B001)" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <button onclick="addBorrowing()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">Add Borrowing</button>
      </div>
    </div>

    <!-- Total Books Section -->
    <div id="total-books" class="section hidden">
      <h2 class="text-2xl font-bold mb-4">Total Books</h2>
      <input id="search-total-books" type="text" placeholder="Search by Title or Author" class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
      <div id="total-books-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>

    <!-- Available Books Section -->
    <div id="available-books" class="section hidden">
      <h2 class="text-2xl font-bold mb-4">Available Books</h2>
      <input id="search-available-books" type="text" placeholder="Search by Title or Author" class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
      <div id="available-books-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>

    <!-- Student Details Section -->
    <div id="student-details" class="section hidden">
      <h2 class="text-2xl font-bold mb-4">Student Borrowing Details</h2>
      <input id="search-student-details" type="text" placeholder="Search by Name, Student ID, Class, or Book Title" class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
      <div id="student-details-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>

    <!-- Settings Section -->
    <div id="settings" class="section hidden">
      <h2 class="text-2xl font-bold mb-4">Settings</h2>
      <div class="bg-gray-700 p-4 rounded-lg mb-4 transition-colors duration-300">
        <h3 class="text-lg font-semibold mb-2">Appearance</h3>
        <label class="inline-flex items-center">
          <input id="theme-toggle" type="checkbox" class="form-checkbox h-5 w-5 text-blue-500">
          <span class="ml-2 text-gray-300 transition-colors duration-300">Enable Dark Mode</span>
        </label>
      </div>
      <div class="bg-gray-700 p-4 rounded-lg transition-colors duration-300">
        <h3 class="text-lg font-semibold mb-2">Change Password</h3>
        <input id="current-password" type="password" placeholder="Current Password" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <input id="new-password" type="password" placeholder="New Password" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <input id="confirm-password" type="password" placeholder="Confirm New Password" class="w-full p-2 mb-2 bg-gray-800 border border-gray-600 rounded text-white transition-colors duration-300">
        <button onclick="changePassword()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Change Password</button>
        <p id="password-error" class="text-red-500 mt-2 hidden">Error: Please check your inputs.</p>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Mock Data
      let books = [
        { id: "B001", title: "Calculus", author: "James Stewart", quantity: 5, available: 3 },
        { id: "B002", title: "Physics", author: "David Halliday", quantity: 4, available: 1 },
        { id: "B003", title: "Chemistry", author: "Raymond Chang", quantity: 6, available: 6 }
      ];

      let studentBorrowing = [
        { studentId: "S001", name: "John Doe", phone: "123-456-7890", class: "BSc CS", bookId: "B001", bookTitle: "Calculus", borrowDate: "2025-08-01" },
        { studentId: "S002", name: "Jane Smith", phone: "987-654-3210", class: "BSc Physics", bookId: "B002", bookTitle: "Physics", borrowDate: "2025-08-02" }
      ];

      // Initialize Password
      if (!localStorage.getItem('librarianPassword')) {
        localStorage.setItem('librarianPassword', 'as23');
        console.log('Initialized librarianPassword to as23');
      }

      // Theme Management
      const applyTheme = (isDark) => {
        const body = document.body;
        const nav = document.querySelector('nav');
        const menu = document.getElementById('menu');
        const cards = document.querySelectorAll('.bg-gray-700');
        const inputs = document.querySelectorAll('input');
        const textElements = document.querySelectorAll('.text-gray-300');
        if (isDark) {
          body.classList.remove('bg-gray-100', 'text-gray-900');
          body.classList.add('bg-gray-900', 'text-white');
          nav.classList.remove('bg-gray-200');
          nav.classList.add('bg-gray-800');
          menu.classList.remove('bg-gray-300');
          menu.classList.add('bg-gray-700');
          cards.forEach(card => {
            card.classList.remove('bg-gray-300');
            card.classList.add('bg-gray-700');
          });
          inputs.forEach(input => {
            input.classList.remove('bg-gray-200', 'border-gray-400', 'text-gray-900');
            input.classList.add('bg-gray-800', 'border-gray-600', 'text-white');
          });
          textElements.forEach(el => {
            el.classList.remove('text-gray-600');
            el.classList.add('text-gray-300');
          });
        } else {
          body.classList.remove('bg-gray-900', 'text-white');
          body.classList.add('bg-gray-100', 'text-gray-900');
          nav.classList.remove('bg-gray-800');
          nav.classList.add('bg-gray-200');
          menu.classList.remove('bg-gray-700');
          menu.classList.add('bg-gray-300');
          cards.forEach(card => {
            card.classList.remove('bg-gray-700');
            card.classList.add('bg-gray-300');
          });
          inputs.forEach(input => {
            input.classList.remove('bg-gray-800', 'border-gray-600', 'text-white');
            input.classList.add('bg-gray-200', 'border-gray-400', 'text-gray-900');
          });
          textElements.forEach(el => {
            el.classList.remove('text-gray-300');
            el.classList.add('text-gray-600');
          });
        }
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        console.log('Applied theme:', isDark ? 'dark' : 'light');
      };

      // Initialize Theme
      const savedTheme = localStorage.getItem('theme') || 'dark';
      const themeToggle = document.getElementById('theme-toggle');
      if (themeToggle) {
        themeToggle.checked = savedTheme === 'dark';
        applyTheme(savedTheme === 'dark');
        themeToggle.addEventListener('change', () => {
          applyTheme(themeToggle.checked);
        });
      }

      // Generate Unique Book ID
      function generateBookId() {
        const count = books.length + 1;
        return `B${count.toString().padStart(3, '0')}`; // e.g., B004
      }

      // Toggle Hamburger Menu
      window.toggleMenu = function() {
        const menu = document.getElementById('menu');
        if (menu) {
          menu.classList.toggle('hidden');
          console.log('Menu toggled:', menu.classList.contains('hidden') ? 'Hidden' : 'Visible');
        } else {
          console.error('Menu element not found');
        }
      };

      // Change Password
      window.changePassword = function() {
        const currentPassword = document.getElementById('current-password').value.trim();
        const newPassword = document.getElementById('new-password').value.trim();
        const confirmPassword = document.getElementById('confirm-password').value.trim();
        const passwordError = document.getElementById('password-error');
        if (!currentPassword || !newPassword || !confirmPassword) {
          passwordError.textContent = 'Error: Please fill all fields.';
          passwordError.style.display = 'block';
          console.log('Password change failed: Missing fields');
          return;
        }
        const storedPassword = localStorage.getItem('librarianPassword');
        console.log('Current password input:', currentPassword);
        console.log('Stored password:', storedPassword);
        if (currentPassword !== storedPassword) {
          passwordError.textContent = 'Error: Current password is incorrect.';
          passwordError.style.display = 'block';
          console.log('Password change failed: Incorrect current password');
          return;
        }
        if (newPassword !== confirmPassword) {
          passwordError.textContent = 'Error: New password and confirm password do not match.';
          passwordError.style.display = 'block';
          console.log('Password change failed: Passwords do not match');
          return;
        }
        if (newPassword.length < 4) {
          passwordError.textContent = 'Error: New password must be at least 4 characters.';
          passwordError.style.display = 'block';
          console.log('Password change failed: New password too short');
          return;
        }
        localStorage.setItem('librarianPassword', newPassword);
        console.log('Password changed to:', newPassword);
        console.log('Stored password after change:', localStorage.getItem('librarianPassword'));
        alert('Password changed successfully!');
        passwordError.style.display = 'none';
        document.getElementById('current-password').value = '';
        document.getElementById('new-password').value = '';
        document.getElementById('confirm-password').value = '';
      };

      // Show Section
      window.showSection = function(sectionId) {
        console.log('Showing section:', sectionId);
        const sections = ['dashboard', 'total-books', 'available-books', 'student-details', 'settings'];
        sections.forEach(id => {
          const section = document.getElementById(id);
          if (section) {
            section.style.display = id === sectionId ? 'block' : 'none';
          } else {
            console.error(`Section ${id} not found`);
          }
        });
        document.getElementById('menu').classList.add('hidden');
        if (sectionId === 'total-books') {
          displayTotalBooks('');
        } else if (sectionId === 'available-books') {
          displayAvailableBooks('');
        } else if (sectionId === 'student-details') {
          displayStudentDetails('');
        }
      };

      // Display Total Books
      function displayTotalBooks(searchTerm) {
        const container = document.getElementById('total-books-list');
        if (!container) {
          console.error('Total books list container not found');
          return;
        }
        container.innerHTML = '';
        const filteredBooks = books.filter(book =>
          book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
          book.author.toLowerCase().includes(searchTerm.toLowerCase())
        );
        filteredBooks.forEach(book => {
          const card = document.createElement('div');
          card.className = 'bg-gray-700 p-4 rounded-lg shadow-md transition-colors duration-300';
          card.innerHTML = `
            <h3 class="text-lg font-semibold">ID: ${book.id}</h3>
            <p class="text-gray-300 transition-colors duration-300">Title: ${book.title}</p>
            <p class="text-gray-300 transition-colors duration-300">Author: ${book.author}</p>
            <p class="text-gray-300 transition-colors duration-300">Total Quantity: ${book.quantity}</p>
            <p class="text-gray-300 transition-colors duration-300">Available: ${book.available}</p>
          `;
          container.appendChild(card);
        });
        console.log('Displayed total books:', filteredBooks.length);
      }

      // Display Available Books
      function displayAvailableBooks(searchTerm) {
        const container = document.getElementById('available-books-list');
        if (!container) {
          console.error('Available books list container not found');
          return;
        }
        container.innerHTML = '';
        const availableBooks = books.filter(book =>
          book.available > 0 &&
          (book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
           book.author.toLowerCase().includes(searchTerm.toLowerCase()))
        );
        availableBooks.forEach(book => {
          const card = document.createElement('div');
          card.className = 'bg-gray-700 p-4 rounded-lg shadow-md transition-colors duration-300';
          card.innerHTML = `
            <h3 class="text-lg font-semibold">ID: ${book.id}</h3>
            <p class="text-gray-300 transition-colors duration-300">Title: ${book.title}</p>
            <p class="text-gray-300 transition-colors duration-300">Author: ${book.author}</p>
            <p class="text-gray-300 transition-colors duration-300">Available: ${book.available}</p>
          `;
          container.appendChild(card);
        });
        console.log('Displayed available books:', availableBooks.length);
      }

      // Display Student Details
      function displayStudentDetails(searchTerm) {
        const container = document.getElementById('student-details-list');
        if (!container) {
          console.error('Student details list container not found');
          return;
        }
        container.innerHTML = '';
        const filteredStudents = studentBorrowing.filter(student =>
          student.studentId.toLowerCase().includes(searchTerm.toLowerCase()) ||
          student.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
          student.class.toLowerCase().includes(searchTerm.toLowerCase()) ||
          student.bookTitle.toLowerCase().includes(searchTerm.toLowerCase())
        );
        filteredStudents.forEach(student => {
          const card = document.createElement('div');
          card.className = 'bg-gray-700 p-4 rounded-lg shadow-md transition-colors duration-300';
          card.innerHTML = `
            <h3 class="text-lg font-semibold">${student.name}</h3>
            <p class="text-gray-300 transition-colors duration-300">Student ID: ${student.studentId}</p>
            <p class="text-gray-300 transition-colors duration-300">Phone: ${student.phone}</p>
            <p class="text-gray-300 transition-colors duration-300">Class: ${student.class}</p>
            <p class="text-gray-300 transition-colors duration-300">Book Borrowed: ${student.bookTitle}</p>
            <p class="text-gray-300 transition-colors duration-300">Borrow Date: ${student.borrowDate}</p>
          `;
          container.appendChild(card);
        });
        console.log('Displayed student details:', filteredStudents.length);
      }

      // Add Book
      window.addBook = function() {
        const title = document.getElementById('add-title').value;
        const author = document.getElementById('add-author').value;
        const quantity = parseInt(document.getElementById('add-quantity').value);
        if (!title || !author || isNaN(quantity) || quantity < 1) {
          alert('Please fill all fields with valid data.');
          return;
        }
        const newBook = {
          id: generateBookId(),
          title,
          author,
          quantity,
          available: quantity
        };
        books.push(newBook);
        console.log('Added book:', newBook);
        alert('Book added successfully!');
        document.getElementById('add-title').value = '';
        document.getElementById('add-author').value = '';
        document.getElementById('add-quantity').value = '';
      };

      // Remove Book
      window.removeBook = function() {
        const idOrTitle = document.getElementById('remove-id').value.trim();
        if (!idOrTitle) {
          alert('Please enter a Book ID or Title.');
          return;
        }
        const index = books.findIndex(book =>
          book.id === idOrTitle || book.title.toLowerCase() === idOrTitle.toLowerCase()
        );
        if (index === -1) {
          alert('Book not found.');
          return;
        }
        const removedBook = books.splice(index, 1)[0];
        studentBorrowing = studentBorrowing.filter(student => student.bookId !== removedBook.id);
        console.log('Removed book:', removedBook);
        alert('Book removed successfully!');
        document.getElementById('remove-id').value = '';
      };

      // Mark Book as Returned
      window.markBookReturned = function() {
        const studentId = document.getElementById('return-student-id').value.trim();
        if (!studentId) {
          alert('Please enter a Student ID.');
          return;
        }
        const borrowIndex = studentBorrowing.findIndex(student => student.studentId === studentId);
        if (borrowIndex === -1) {
          alert('No borrowing record found for this Student ID.');
          return;
        }
        const borrowing = studentBorrowing[borrowIndex];
        const book = books.find(book => book.id === borrowing.bookId);
        if (book) {
          book.available += 1;
          console.log('Updated book available count:', book);
        }
        studentBorrowing.splice(borrowIndex, 1);
        console.log('Marked book returned for student:', studentId);
        alert('Book marked as returned!');
        document.getElementById('return-student-id').value = '';
      };

      // Add Student Borrowing
      window.addBorrowing = function() {
        const studentId = document.getElementById('borrow-student-id').value.trim();
        const name = document.getElementById('borrow-name').value.trim();
        const phone = document.getElementById('borrow-phone').value.trim();
        const className = document.getElementById('borrow-class').value.trim();
        const bookId = document.getElementById('borrow-book-id').value.trim();
        if (!studentId || !name || !phone || !className || !bookId) {
          alert('Please fill all fields.');
          return;
        }
        const book = books.find(book => book.id === bookId);
        if (!book) {
          alert('Book ID not found.');
          return;
        }
        if (book.available < 1) {
          alert('No copies of this book are available.');
          return;
        }
        const borrowDate = new Date().toISOString().split('T')[0]; // Current date
        const borrowing = {
          studentId,
          name,
          phone,
          class: className,
          bookId,
          bookTitle: book.title,
          borrowDate
        };
        studentBorrowing.push(borrowing);
        book.available -= 1;
        console.log('Added borrowing:', borrowing);
        console.log('Updated book available count:', book);
        alert('Borrowing record added successfully!');
        document.getElementById('borrow-student-id').value = '';
        document.getElementById('borrow-name').value = '';
        document.getElementById('borrow-phone').value = '';
        document.getElementById('borrow-class').value = '';
        document.getElementById('borrow-book-id').value = '';
      };

      // Search Event Listeners
      document.getElementById('search-total-books')?.addEventListener('input', (e) => {
        displayTotalBooks(e.target.value);
      });
      document.getElementById('search-available-books')?.addEventListener('input', (e) => {
        displayAvailableBooks(e.target.value);
      });
      document.getElementById('search-student-details')?.addEventListener('input', (e) => {
        displayStudentDetails(e.target.value);
      });

      // Initialize Dashboard
      showSection('dashboard');
    });
  </script>
</body>
</html>